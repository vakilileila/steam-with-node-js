<link rel="stylesheet" href="/public/css/kendo/kendo.common.min.css">
<link rel="stylesheet" href="/public/css/kendo/kendo.material.min.css">
<link rel="stylesheet" href="/public/css/kendo/kendo.rtl.min.css">

<article class="content" xmlns="http://www.w3.org/1999/html">
    <div class="createHero">

        <% if (errors.length > 0) { %>
        <div class="alert alert-danger" role="alert">
            <ul>
                <% errors.forEach(function (err) { %>
                <li><%= err %></li>
                <% }) %>
            </ul>
        </div>
        <% } %>

        <form action="/admin/hero/create" method="post">

            <div class="row">
                <div class="col-md-6">
                    <label>Item name</label>
                    <input type="text" name="name"></div>
                <!--JSON.stringify(cat)-->
                <div class="col-md-6">
                    <label>hros</label>
                    <select name="category">

                    </select>

                    <input id="categories">
                    <input type="hidden" name="category" id="category">
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div id="uploader">
                        <div id="drop_element"
                             style="width: 600px;height: 200px;border: dashed 5px #555555;padding: 50px">
                            <a class="btn btn-primary" id="btn_choosefile">Upload File</a>
                        </div>
                        <img src="" id="uploadedFile" style="display: none">
                        <input type="hidden" name="image" id="imageUrl">
                    </div>
                    <label>upload image</label>
                    <input type="text" name="imageUrl">
                    <button>upload</button>
                </div>

                <input type="hidden" name="imageUrl">

                <div class="col-md-6">
                    <label>price</label>
                    <input type="text" name="itemName">
                </div>
            </div>
            <div class="row">
                <div class="col-md-12" style="text-align: center; margin: 20px 0;">
                    <input type="submit">
                </div>
                <div class="col-md-12 edit-button"><a href="/admin/heros">
                        <button type="button" id="myButton" data-loading-text="Loading..." class="btn btn-primary"
                                autocomplete="off">
                            edit itemHero
                            <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                        </button>
                    </a></div>
            </div>

        </form>
    </div>
</article>

<script src="/public/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/public/bower_components/plupload/js/plupload.full.min.js"></script>
<script>
    window.JalaliDate = Date;
</script>
<script src="/public/js/kendo.all.2015.2.624.hasPersian.js"></script>

<script>
    var uploader = new plupload.Uploader({
        container: document.getElementById('uploader'),
        browse_button: 'btn_choosefile',
        runtimes: 'html5,flash,silverlight,html4',
        url: "/api/upload",
        filters: [
            {title: "Image files", extensions: "jpg,gif,png"},
        ],
        drop_element: 'drop_element',
        dragdrop: true,

        init: {
            FileUploaded: function (file, up, res) {
                var fileName = JSON.parse(res.response).fileName;
                $('#imageUrl').val(fileName);
                $('#uploadedFile').attr('src', '/' + fileName);
                $('#uploadedFile').show();
            },
            FilesAdded: function (up, files) {
                debugger;
                up.start();
            }
        }
    });
    uploader.init();

    $('#categories').kendoComboBox({
        dataTextField: 'name',
        dataValueField: '_id',
        filter: "contains",
        autoBind: false,
        minLength: 3,
        dataSource: {
            serverFiltering: true,
            transport: {
                read: {
                    url: '/api/categories'
                }
            }
        },
        select: function (e) {
            var dataItem = this.dataItem(e.item.index());
            $('#category').val(JSON.stringify(dataItem));
        }
    })
</script>